"use strict";window.addEventListener("load",function(){function d(e){var t=document.querySelector("main"),n=document.createElement("div"),o=document.createElement("span");n.classList.add("alert"),o.classList.add("alert__close"),n.innerHTML=e,n.appendChild(o),t.appendChild(n),o.addEventListener("click",function(e){e.preventDefault(),n.classList.add("out"),setTimeout(function(){t.removeChild(n)},2e3)})}window.Req=function(){this.send=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){1==t.readyState&&e.cb_before&&e.cb_before()},t.onload=t.onerror=function(){e.cb_after&&e.cb_after(),200!=t.status?console.error("Error: ".concat(t.status," ").concat(t.statusText)):e.cb_success&&e.cb_success(t)},t.open("POST",e.url,!0),e.data?t.send(e.data):t.send()},this.getData=function(e){return new FormData(e)}},window.showBanner=d,window.Urls={account:"../parts/authorized/account.php",char:"../parts/authorized/char.php",feedback:"../parts/authorized/feedback.php",vote:"../parts/authorized/vote.php",vote_up:"../service/vote_up.php",feedback_send:"../service/feedback.php",change_pass:"../service/change_pass.php",char_service:"../service/char_service.php",aut:"../service/aut.php",exit:"../service/exit.php",reg:"../service/reg.php"},window.Downloadeds={account:{state:!1,html:null},char:{state:!1,html:null},feedback:{state:!1,html:null},vote:{state:!1,html:null}},window.Events={account:function(){(new Account).upEvent()},char:function(){(new Char).upEvent()},feedback:function(){var e=new Feedback;e.upEvent()},vote:function(){var e=new Vote;e.upEvent()}},window.Confirm=function(){var o=this,n=document.querySelector(".confirm"),c=n.querySelector(".confirm__form"),t=n.querySelector("#char_guid"),r=n.querySelector("#service_type"),a=n.querySelector(".confirm__service-name"),s=n.querySelector(".confirm__service-char"),i=n.querySelector(".confirm__form-span--price"),u=n.querySelector(".confirm__form-btn--close");this.send=function(e){var t=0<arguments.length&&void 0!==e&&e;t&&t.preventDefault();var n=new Req;n.send({url:Urls.char_service,data:n.getData(c),cb_before:function(){document.querySelector(".confirm__form").classList.add("load"),document.querySelector(".confirm__form-btn[type='submit']").setAttribute("disabled","disabled")},cb_after:function(){document.querySelector(".confirm__form").classList.remove("load"),document.querySelector(".confirm__form-btn[type='submit']").removeAttribute("disabled"),o.closeConfirm()},cb_success:function(e){d(e.responseText)}})},this.createConfirm=function(e){n.classList.add("active"),document.body.classList.add("oveflow"),a.textContent=e.title,s.textContent=e.char,i.textContent=e.price,t.value=e.guild,r.value=e.type},this.closeConfirm=function(e){var t=0<arguments.length&&void 0!==e&&e;t&&t.preventDefault(),document.body.classList.remove("oveflow"),u.removeEventListener("click",o.closeConfirm),c.removeEventListener("submit",o.send),n.classList.remove("active")},c.addEventListener("submit",this.send),u.addEventListener("click",this.closeConfirm)},window.Menu=function(){var t=this,e=document.querySelector(".aside"),n=e.querySelectorAll(".aside__btn[data-type]"),o=document.querySelector(".section"),c=document.querySelector(".section__block"),r=e.querySelector("#exit_btn");function a(e,t,n){n||(window.Downloadeds[t].html=e.responseText,window.Downloadeds[t].state=!0),c.innerHTML=window.Downloadeds[t].html,window.Events[t]()}this.getPage=function(t){window.Downloadeds[t].state?a(window.Downloadeds[t].html,t,window.Downloadeds[t].state):(new Req).send({url:Urls[t],data:null,cb_before:function(){o.classList.add("load")},cb_after:function(){o.classList.remove("load")},cb_success:function(e){a(e,t)}})},this.exit=function(){(new Req).send({url:Urls.exit,data:null,cb_success:function(){window.location="/"}})},n.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),function(e,t){e.forEach(function(e){return e.classList.remove("active")}),t.classList.add("active")}(n,e.target),function(e){var t=document.querySelector(".section__title"),n=e.dataset.title;t.textContent=n}(e.target),t.getPage(e.target.dataset.type)})}),r.addEventListener("click",function(e){e.preventDefault(),t.exit()})},window.Account=function(){var e=this,t=(document.querySelector(".account"),document.querySelector("#сhangePass")),n=document.querySelector(".account__pass-block"),o=document.querySelector(".account__form"),c=document.querySelector(".account__form-result");function r(e){e.preventDefault();var t=new Req;t.send({url:Urls.change_pass,data:t.getData(o),cb_before:function(){o.classList.add("load")},cb_after:function(){o.classList.remove("load")},cb_success:function(e){d(e.responseText),c.innerHTML=e.responseText}})}this.togglePassBlock=function(){n.classList.toggle("active")},this.upEvent=function(){t.addEventListener("click",e.togglePassBlock),o.addEventListener("submit",r)}},window.Char=function(){var n=this,e=document.querySelectorAll(".char__item[data-id]");this.useService=function(e,t){var n=e.dataset.id,o=t.dataset.type,c=t.dataset.price,r=e.querySelector(".char__name").textContent;(new Confirm).createConfirm({title:t.textContent,char:r,guild:n,type:o,price:c})},this.upEvent=function(){e.forEach(function(t){t.addEventListener("click",function(e){e.target.dataset.type&&n.useService(t,e.target)})})}},window.Feedback=function(){var e=this,n=document.querySelector(".feedback").querySelector(".feedback__form");this.sendForm=function(e){e&&e.preventDefault();var t=new Req;t.send({url:Urls.feedback_send,data:t.getData(n),cb_before:function(){n.classList.add("load")},cb_after:function(){n.classList.remove("load")},cb_success:function(e){d(e.responseText),n.innerHTML=e.responseText}})},this.upEvent=function(){n.addEventListener("submit",e.sendForm)}},window.Aut=function(){var t=this,n=document.querySelector(".authorization__form"),o=(n.querySelector(".authorization__btn--aut"),n.querySelector(".authorization__result"));this.sendForm=function(){var e=new Req;e.send({url:Urls.aut,data:e.getData(n),cb_before:function(){o.innerHTML="Ждём...",n.classList.add("authorization__form--load")},cb_after:function(){n.classList.remove("authorization__form--load")},cb_success:function(e){1==e.responseText?window.location="/":(o.innerHTML=e.responseText,d(e.responseText))}})},n.addEventListener("submit",function(e){e.preventDefault(),t.sendForm()})},window.Vote=function(){var e=this,t=document.querySelector(".vote__btn--add");document.querySelector(".vote__btn--vote"),this.upVote=function(){(new Req).send({url:Urls.vote_up,cb_before:function(){document.querySelector(".section").classList.add("load"),t.setAttribute("disabled","true")},cb_after:function(){document.querySelector(".section").classList.remove("load")},cb_success:function(e){d(e.responseText)}})},this.upEvent=function(){t.addEventListener("click",e.upVote)}},window.Reg=function(){var t=this,n=document.querySelector(".authorization__form"),o=n.querySelector(".authorization__result");this.sendForm=function(){var e=new Req;e.send({url:Urls.reg,data:e.getData(n),cb_before:function(){o.innerHTML="Ждём...",n.classList.add("authorization__form--load")},cb_after:function(){n.classList.remove("authorization__form--load")},cb_success:function(e){o.innerHTML=e.responseText,d(e.responseText)}})},n.addEventListener("submit",function(e){e.preventDefault(),t.sendForm()})},document.querySelector(".aside")&&(new Menu).getPage("account");if(document.querySelector(".account"))new Account;if(document.querySelector(".authorization--reg"))new Reg;else if(document.querySelector(".authorization__form"))new Aut;if(document.querySelector(".feedback__form"))new Feedback});